
## 1. 功能概述

任务中心作为应用的核心功能之一，统一管理各类传输任务，包括上传/下载、后台任务、网盘下载及无线果闪传等功能。本文档在原需求基础上补充具体实现细节和技术指标。

## 2. 数据处理规范

### 2.1 数据持久化规则

1. 任务数据存储
    
    - 使用 SQLite 本地数据库存储任务信息
    - 任务基本信息：ID、类型、状态、创建时间、修改时间、源地址、目标地址
    - 任务进度信息：已完成大小、总大小、已完成项数、总项数、传输速度
    - 任务状态：等待中(0)、进行中(1)、已暂停(2)、已完成(3)、失败(4)
2. 进度保存机制
    
    - 传输进度每256KB更新一次内存数据
    - 每5秒或进度变化超过1%时写入数据库
    - 应用关闭时强制保存所有任务进度
3. 断点续传支持
    
    - 支持单文件级别断点续传
    - 记录文件块传输状态(已完成/未完成)
    - 文件块大小：一般文件2MB，视频文件5MB
    - 续传时验证文件MD5确保一致性

### 2.2 数据展示规则

1. 文件大小显示
    
    - < 1KB：显示"xxB"
    - 1KB ~ 999KB：显示"xxx.xx KB"，保留整数
    - 1MB ~ 999MB：显示"xxx.xx MB"，保留一位小数
    - ≥ 1GB：显示"xxx.xx GB"，保留两位小数
2. 传输速度显示
    
    - 更新频率：每秒更新一次
    - 显示规则同文件大小，末尾加上"/s"
    - 低于128KB/s时显示为"较慢"
    - 网络异常时显示"--/s" <font color="#c0504d">网络异常</font>
3. 进度显示
    
    - 进度条最小变化单位：1%
    - 进度百分比显示：保留一位小数
    - 批量任务进度：已完成项数/总项数
    - 总进度=所有文件已传输大小/所有文件总大小
4. 文件名显示
    
    - 单行最多显示20个字符，超出显示"..."
    - 支持显示emoji及特殊字符
    - 文件夹名称末尾显示"/"符号
    - 批量任务显示首个文件名+"等x项"

## 3. 性能指标要求

### 3.1 响应时间指标

1. 页面加载
    
    - 首次加载：≤2秒
    - 二次加载：≤1秒
    - 页面切换：≤0.5秒
    - 列表滚动：≥45fps
2. 操作响应
    
    - 单任务操作：≤200ms
    - 批量操作(≤10项)：≤500ms
    - 批量操作(>10项)：≤1秒
    - Tab切换：≤300ms

### 3.2 资源消耗限制

1. CPU使用率
    
    - 前台运行：平均≤30%，峰值≤60%
    - 后台运行：平均≤15%，峰值≤30%
    - 空闲状态：≤5%
2. 内存使用
    
    - 前台运行：≤150MB
    - 后台运行：≤100MB
    - 后台任务：≤50MB
3. 存储空间
    
    - 数据库大小：≤50MB
    - 缓存文件：≤200MB
    - 定期清理：每周清理一次过期缓存

### 3.3 并发处理能力

1. 传输任务
    
    - 同时传输任务数：≤5个
    - 最大等待任务数：≤100个
    - 单个批量任务最大文件数：≤1000个
2. 列表加载
    
    - 单次最大加载条数：50条
    - 滚动加载阈值：距底部100px
    - 加载动画持续时间：≥500ms

## 4. 错误处理机制

### 4.1 网络异常处理

1. 弱网环境
    
    - 网速低于50KB/s持续10秒：显示弱网警告
    - 网速低于10KB/s持续30秒：自动暂停任务
    - 网络恢复：提示是否继续任务
2. 网络断开
    
    - 立即暂停所有传输任务
    - 显示网络断开提示
    - 网络恢复后自动重试一次
    - 重试失败需手动继续

### 4.2 存储空间异常

1. 空间不足预警
    
    - 剩余空间<1GB：显示警告提示
    - 剩余空间<100MB：暂停下载任务
    - 定期检查：每5分钟检查一次
2. 存储权限
    
    - 首次使用请求权限
    - 权限被收回：暂停相关任务
    - 提示用户重新授权

### 4.3 传输异常处理

1. 文件访问失败
    
    - 重试次数：3次
    - 重试间隔：5秒
    - 重试失败：显示具体错误原因
2. 文件损坏
    
    - 传输完成后校验MD5
    - 校验失败：自动重试一次
    - 再次失败：提示文件损坏
3. 设备断开
    
    - 立即暂停相关任务
    - 显示设备断开提示
    - 支持重新连接后继续

### 4.4 错误提示规范

1. 提示显示
    
    - Toast提示：显示2秒
    - 警告提示：固定显示，可手动关闭
    - 错误提示：需手动确认
2. 错误日志
    
    - 本地保存最近7天日志
    - 记录：错误类型、时间、相关任务信息
    - 支持日志导出功能

## 5. 用户体验优化

### 5.1 操作体验

1. 任务管理
    
    - 支持多选操作：最多100项
    - 批量操作时显示进度条
    - 可随时取消批量操作
    - 拖拽排序：支持上传/下载任务排序
2. 确认机制
    
    - 批量删除：显示影响任务数
    - 清空操作：二次确认
    - 取消传输：提示已传输进度
    - 退出应用：提示后台任务情况

### 5.2 界面交互

1. 视觉反馈
    
    - 点击效果：高亮持续200ms
    - 进度条动画：线性过渡
    - 状态切换：渐变动画300ms
    - 列表更新：渐入渐出200ms
2. 手势操作
    
    - 左滑显示操作按钮
    - 下拉刷新：支持所有列表
    - 任务项左右滑动切换标签
    - 双击标题回到顶部

### 5.3 通知提醒

1. 任务通知
    
    - 合并显示：最多显示3条
    - 进度更新：每5秒或进度变化超过5%
    - 支持通知栏操作：暂停/继续/取消
2. 完成提醒
    
    - 单任务完成：简单提示
    - 批量任务完成：显示详细信息
    - 可配置提醒方式：声音/震动

## 6. 安全性要求

### 6.1 数据安全

1. 传输加密
    
    - 支持HTTPS传输
    - 本地传输使用TLS 1.3
    - 文件传输支持断点续传时的校验
2. 隐私保护
    
    - 不记录敏感文件信息
    - 传输记录可手动清除
    - 支持隐私模式：不保存记录

### 6.2 访问控制

1. 权限管理
    
    - 区分读写权限
    - 支持外部存储访问限制
    - 定期检查权限有效性
2. 操作限制
    
    - 防止重复操作：500ms内
    - 限制批量操作数量：≤100
    - 大文件操作需确认

## 7. 兼容性要求

### 7.1 系统兼容

1. Android版本
    
    - 最低支持：Android 6.0
    - 目标版本：Android 13
    - 适配分屏模式
2. iOS版本
    
    - 最低支持：iOS 12.0
    - 目标版本：iOS 16
    - 适配深色模式

### 7.2 设备兼容

1. 屏幕适配
    
    - 支持分辨率：320dp-1080dp
    - 适配刘海屏/水滴屏
    - 支持分屏显示
2. 硬件适配
    
    - 支持蓝牙5.0
    - 支持Wi-Fi 6
    - 适配可折叠设备